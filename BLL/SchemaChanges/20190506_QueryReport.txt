-- v1.8.8 2019.05.06 Alex

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[sp_DuplicateReport]
(
	@param1 int 
)
AS
BEGIN
SET NOCOUNT ON;

DECLARE @MAXID INT; SET @MAXID = (SELECT MAX(ID) FROM REPORT)+1

SET IDENTITY_INSERT REPORT ON
INSERT INTO REPORT ([ID], [DATABASEID], [SVID], [REPORTNAME], [AUDODATE], [CATEGORY], [TYPE], [REPORTGROUPLIST], [RPTITLE], [ADDUSER], [DEFAULTFORMAT], [EXTENDFIELD], [PRINT_ORIENTATION], [PRINT_FITTOPAGE], [REPORT_HEADER], [REPORT_FOOTER], [FONT_FAMILY], [SUBCOUNT_LABEL], [PDF_GRID_LINES])
SELECT @MAXID AS ID, [DATABASEID], [SVID], [REPORTNAME]=(CASE (SELECT COUNT(*) FROM [REPORT] WHERE [REPORTNAME] = r.[REPORTNAME]+' - Copy') WHEN 0 THEN r.[REPORTNAME]+' - Copy' ELSE r.[REPORTNAME]+' - Copy(' + (SELECT CONVERT(VARCHAR,COUNT(*)) FROM [REPORT] WHERE [REPORTNAME] LIKE r.[REPORTNAME]+' - Copy%') + ')' END), [AUDODATE], [CATEGORY], [TYPE], [REPORTGROUPLIST], [RPTITLE], [ADDUSER], [DEFAULTFORMAT], [EXTENDFIELD], [PRINT_ORIENTATION], [PRINT_FITTOPAGE], [REPORT_HEADER], [REPORT_FOOTER], [FONT_FAMILY], [SUBCOUNT_LABEL], [PDF_GRID_LINES] FROM REPORT r WHERE ID = @param1
SET IDENTITY_INSERT REPORT OFF

INSERT INTO REPORTCOLUMN 
SELECT @MAXID AS RPID,[COLUMNNAME], [COLUMNFUNC], [CRITERIA1], [CRITERIA2], [CRITERIA3], [CRITERIA4], [AUDODATE], [SOURCEVIEWCOLUMNID], [DISPLAYNAME], [COLUMNTYPE], [COLUMNCOMMENT], [FORMULAFIELDID], [HIDDEN], [SEQ], [EXCEL_COLWIDTH], [FONT_SIZE], [FONT_BOLD], [FONT_ITALIC], [HORIZONTAL_TEXT_ALIGN], [CELL_FORMAT], [BACKGROUND_COLOR], [FONT_COLOR], [IS_NUMERIC], [IS_ASCENDING] FROM [REPORTCOLUMN] WHERE RPID = @param1

SELECT @MAXID

END
