--v1.1.0 - Cheong - 2016/05/18 - Drop unneeded views
IF (SELECT COUNT(*) FROM [INFORMATION_SCHEMA].[VIEWS] WHERE TABLE_NAME = 'V_REPORT') > 0
BEGIN
	DROP VIEW V_REPORT
END

IF (SELECT COUNT(*) FROM [INFORMATION_SCHEMA].[VIEWS] WHERE TABLE_NAME = 'V_REPORTLIST') > 0
BEGIN
	DROP VIEW V_REPORTLIST
END

IF (SELECT COUNT(*) FROM [INFORMATION_SCHEMA].[VIEWS] WHERE TABLE_NAME = 'V_DATABASE') > 0
BEGIN
	DROP VIEW V_DATABASE
END

IF (SELECT COUNT(*) FROM [INFORMATION_SCHEMA].[VIEWS] WHERE TABLE_NAME = 'V_USER') > 0
BEGIN
	DROP VIEW V_USER
END

IF (SELECT COUNT(*) FROM [INFORMATION_SCHEMA].[VIEWS] WHERE TABLE_NAME = 'V_WORDFILE') > 0
BEGIN
	DROP VIEW V_WORDFILE
END

IF (SELECT COUNT(*) FROM [INFORMATION_SCHEMA].[VIEWS] WHERE TABLE_NAME = 'V_WORDFILE2') > 0
BEGIN
	DROP VIEW V_WORDFILE2
END

IF (SELECT COUNT(*) FROM [INFORMATION_SCHEMA].[VIEWS] WHERE TABLE_NAME = 'V_WORDREPORT') > 0
BEGIN
	DROP VIEW V_WORDREPORT
END

IF (SELECT COUNT(*) FROM [INFORMATION_SCHEMA].[VIEWS] WHERE TABLE_NAME = 'V_WORDTEMPLATE') > 0
BEGIN
	DROP VIEW V_WORDTEMPLATE
END

GO
--v1.1.0 - Cheong - 2016/05/18 - Add column for hashkey
SET NOCOUNT ON
IF NOT EXISTS (SELECT * FROM sys.objects o INNER JOIN sys.columns c ON o.object_id = c.object_id WHERE o.name = 'DATABASE' AND c.name = 'HASHKEY')
BEGIN
	BEGIN TRAN
	BEGIN TRY
		EXEC sp_executesql N'ALTER TABLE [dbo].[DATABASE] ADD [HASHKEY] nvarchar(50) NULL'
		EXEC sp_executesql N'UPDATE [dbo].[DATABASE] SET [HASHKEY] = N''com'''
		EXEC sp_executesql N'ALTER TABLE [dbo].[DATABASE] ALTER COLUMN [HASHKEY] nvarchar(50) NOT NULL'
		EXEC sp_executesql N'ALTER TABLE dbo.[DATABASE] SET (LOCK_ESCALATION = TABLE)'
		COMMIT
		PRINT N'INFO: Column(s) has been added successfully.'
	END TRY
	BEGIN CATCH
		PRINT N'INFO: Error occur when adding columns.'
		ROLLBACK
	END CATCH
END
ELSE
BEGIN
	PRINT N'INFO: Column(s) has been added already.'
END
SET NOCOUNT OFF
GO
