/*******************************************************************************************************************************************************/
-- dbo.fn_GetDate replace GETDATE()

/****** Object:  UserDefinedFunction [dbo].[fn_GetDate]    Script Date: 19/7/2017 10:07:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

-- =============================================
-- Author:		Fai
-- Create date: 2017.07.10
-- Description:	To replace GETDATE() for solve the TimeZone issue on SQL Azure
-- =============================================
CREATE FUNCTION [dbo].[fn_GetDate]  ()
RETURNS Datetime
AS
BEGIN
	
	RETURN DATEADD(Hour, 0, GETDATE())
END


/*******************************************************************************************************************************************************/
-- dbo.fn_GetDate replace GETDATE()

IF EXISTS(SELECT 1 FROM sys.objects WHERE object_id = OBJECT_ID(N'dbo.DF_APPLICATION_AUDODATE'))
BEGIN 
	ALTER TABLE [dbo].[APPLICATION] DROP CONSTRAINT [DF_APPLICATION_AUDODATE]
	ALTER TABLE [dbo].[APPLICATION] ADD CONSTRAINT [DF_APPLICATION_AUDODATE] DEFAULT (dbo.fn_GetDate()) FOR [AUDODATE]
END
GO

IF EXISTS(SELECT 1 FROM sys.objects WHERE object_id = OBJECT_ID(N'dbo.DF_DATABASE_AUDOTIME'))
BEGIN
	ALTER TABLE [dbo].[DATABASE] DROP CONSTRAINT [DF_DATABASE_AUDOTIME]
	ALTER TABLE [dbo].[DATABASE] ADD CONSTRAINT [DF_DATABASE_AUDOTIME] DEFAULT (dbo.fn_GetDate()) FOR [AUDOTIME]
END
GO

IF EXISTS(SELECT 1 FROM sys.objects WHERE object_id = OBJECT_ID(N'dbo.DF_DATABASE_LASTMODIFYDATE'))
BEGIN
	ALTER TABLE [dbo].[DATABASE] DROP CONSTRAINT [DF_DATABASE_LASTMODIFYDATE]
	ALTER TABLE [dbo].[DATABASE] ADD CONSTRAINT [DF_DATABASE_LASTMODIFYDATE] DEFAULT (dbo.fn_GetDate()) FOR [LASTMODIFYDATE]
END
GO

IF EXISTS(SELECT 1 FROM sys.objects WHERE object_id = OBJECT_ID(N'dbo.DF_GROUPRIGHT_AUDODATE'))
BEGIN
	ALTER TABLE [dbo].[GROUPRIGHT] DROP CONSTRAINT [DF_GROUPRIGHT_AUDODATE]
	ALTER TABLE [dbo].[GROUPRIGHT] ADD CONSTRAINT [DF_GROUPRIGHT_AUDODATE] DEFAULT (dbo.fn_GetDate()) FOR [AUDODATE]
END
GO

IF EXISTS(SELECT 1 FROM sys.objects WHERE object_id = OBJECT_ID(N'dbo.DF_REPORT_AUTOTIME'))
BEGIN
	ALTER TABLE [dbo].[REPORT] DROP CONSTRAINT [DF_REPORT_AUTOTIME]
	ALTER TABLE [dbo].[REPORT] ADD CONSTRAINT [DF_REPORT_AUTOTIME] DEFAULT (dbo.fn_GetDate()) FOR [AUDODATE]
END
GO

IF EXISTS(SELECT 1 FROM sys.objects WHERE object_id = OBJECT_ID(N'dbo.DF_REPORTGROUP_DADOTIME'))
	BEGIN
	ALTER TABLE [dbo].[REPORTGROUP] DROP CONSTRAINT [DF_REPORTGROUP_DADOTIME]
	ALTER TABLE [dbo].[REPORTGROUP] ADD CONSTRAINT [DF_REPORTGROUP_AUTOTIME] DEFAULT (dbo.fn_GetDate()) FOR [AUDOTIME]
END
GO

IF EXISTS(SELECT 1 FROM sys.objects WHERE object_id = OBJECT_ID(N'dbo.DF_RPCATEGORY_AUDODATE'))
BEGIN
	ALTER TABLE [dbo].[RPCATEGORY] DROP CONSTRAINT [DF_RPCATEGORY_AUDODATE]
	ALTER TABLE [dbo].[RPCATEGORY] ADD CONSTRAINT [DF_RPCATEGORY_AUDODATE] DEFAULT (dbo.fn_GetDate()) FOR [AUDODATE]
END
GO

IF EXISTS(SELECT 1 FROM sys.objects WHERE object_id = OBJECT_ID(N'dbo.DF_SELECTEDCOLUMN_AUDODATE'))
BEGIN
	ALTER TABLE [dbo].[REPORTCOLUMN] DROP CONSTRAINT [DF_SELECTEDCOLUMN_AUDODATE]
	ALTER TABLE [dbo].[REPORTCOLUMN] ADD CONSTRAINT [DF_SELECTEDCOLUMN_AUDODATE] DEFAULT (dbo.fn_GetDate()) FOR [AUDODATE]
END
GO

IF EXISTS(SELECT 1 FROM sys.objects WHERE object_id = OBJECT_ID(N'dbo.DF_SENSITIVITYLEVEL_AUDOTIME'))
	BEGIN
	ALTER TABLE [dbo].[SENSITIVITYLEVEL] DROP CONSTRAINT [DF_SENSITIVITYLEVEL_AUDOTIME]
	ALTER TABLE [dbo].[SENSITIVITYLEVEL] ADD CONSTRAINT [DF_SENSITIVITYLEVEL_AUDOTIME] DEFAULT (dbo.fn_GetDate()) FOR [AUDOTIME]
END
GO

IF EXISTS(SELECT 1 FROM sys.objects WHERE object_id = OBJECT_ID(N'dbo.DF_SOURCEVIEW_AUTOTIME'))
BEGIN
	ALTER TABLE [dbo].[SOURCEVIEW] DROP CONSTRAINT [DF_SOURCEVIEW_AUTOTIME]
	ALTER TABLE [dbo].[SOURCEVIEW] ADD CONSTRAINT [DF_SOURCEVIEW_AUTOTIME] DEFAULT (dbo.fn_GetDate()) FOR [AUDODATE]
END
GO

IF EXISTS(SELECT 1 FROM sys.objects WHERE object_id = OBJECT_ID(N'dbo.DF_USER_AUTODATE'))
BEGIN
	ALTER TABLE [dbo].[USER] DROP CONSTRAINT [DF_USER_AUTODATE]
	ALTER TABLE [dbo].[USER] ADD CONSTRAINT [DF_USER_AUTODATE] DEFAULT (dbo.fn_GetDate()) FOR [AUTODATE]
END
GO

IF EXISTS(SELECT 1 FROM sys.objects WHERE object_id = OBJECT_ID(N'dbo.DF_USERGROUP_AUDODATE'))
BEGIN
	ALTER TABLE [dbo].[USERGROUP] DROP CONSTRAINT [DF_USERGROUP_AUDODATE]
	ALTER TABLE [dbo].[USERGROUP] ADD CONSTRAINT [DF_USERGROUP_AUDODATE] DEFAULT (dbo.fn_GetDate()) FOR [AUDODATE]
END
GO

IF EXISTS(SELECT 1 FROM sys.objects WHERE object_id = OBJECT_ID(N'dbo.DF_WORDFILE_CREATEDATE'))
BEGIN
	ALTER TABLE [dbo].[WORDFILE] DROP CONSTRAINT [DF_WORDFILE_CREATEDATE]
	ALTER TABLE [dbo].[WORDFILE] ADD CONSTRAINT [DF_WORDFILE_CREATEDATE] DEFAULT (dbo.fn_GetDate()) FOR [CreateDate]
END
GO

IF EXISTS(SELECT 1 FROM sys.objects WHERE object_id = OBJECT_ID(N'dbo.DF_WORDFILE_MODIFYDATE'))
BEGIN
	ALTER TABLE [dbo].[WORDFILE] DROP CONSTRAINT [DF_WORDFILE_MODIFYDATE]
	ALTER TABLE [dbo].[WORDFILE] ADD CONSTRAINT [DF_WORDFILE_MODIFYDATE] DEFAULT (dbo.fn_GetDate()) FOR [ModifyDate]
END
GO

IF EXISTS(SELECT 1 FROM sys.objects WHERE object_id = OBJECT_ID(N'dbo.DF_WORDTEMPLATE_CREATEDATE'))
BEGIN
	ALTER TABLE [dbo].[WORDTEMPLATE] DROP CONSTRAINT [DF_WORDTEMPLATE_CREATEDATE]
	ALTER TABLE [dbo].[WORDTEMPLATE] ADD CONSTRAINT [DF_WORDTEMPLATE_CREATEDATE] DEFAULT (dbo.fn_GetDate()) FOR [CreateDate]
END
GO

IF EXISTS(SELECT 1 FROM sys.objects WHERE object_id = OBJECT_ID(N'dbo.DF_WORDTEMPLATE_MODIFYDATE'))
BEGIN
	ALTER TABLE [dbo].[WORDTEMPLATE] DROP CONSTRAINT [DF_WORDTEMPLATE_MODIFYDATE]
	ALTER TABLE [dbo].[WORDTEMPLATE] ADD CONSTRAINT [DF_WORDTEMPLATE_MODIFYDATE] DEFAULT (dbo.fn_GetDate()) FOR [ModifyDate]
END
GO